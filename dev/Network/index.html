<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Network · DHNetworkSimulator</title><meta name="title" content="Network · DHNetworkSimulator"/><meta property="og:title" content="Network · DHNetworkSimulator"/><meta property="twitter:title" content="Network · DHNetworkSimulator"/><meta name="description" content="Documentation for DHNetworkSimulator."/><meta property="og:description" content="Documentation for DHNetworkSimulator."/><meta property="twitter:description" content="Documentation for DHNetworkSimulator."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">DHNetworkSimulator</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../Plug_method/">Plug Method</a></li><li><span class="tocitem">Network</span><ul><li class="is-active"><a class="tocitem" href>Network</a><ul class="internal"><li><a class="tocitem" href="#Features"><span>Features</span></a></li><li><a class="tocitem" href="#Implementation-details"><span>Implementation details</span></a></li><li><a class="tocitem" href="#Structural-Assumptions-(Validated-at-Simulation-Start)"><span>Structural Assumptions (Validated at Simulation Start)</span></a></li><li><a class="tocitem" href="#Neighbor-Caching-(NeighborDicts)"><span>Neighbor Caching (<code>NeighborDicts</code>)</span></a></li><li><a class="tocitem" href="#Typical-Workflows"><span>Typical Workflows</span></a></li><li><a class="tocitem" href="#Network-visualization"><span>Network visualization</span></a></li><li><a class="tocitem" href="#When-to-Use-Network"><span>When to Use <code>Network</code></span></a></li></ul></li><li><a class="tocitem" href="../types/">Nodes and Edges</a></li></ul></li><li><a class="tocitem" href="../simulation/">Simulation</a></li><li><a class="tocitem" href="../API/">API</a></li><li><a class="tocitem" href="../search/">Search</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Network</a></li><li class="is-active"><a href>Network</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Network</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/PajaS22/DHNetworkSimulator" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Network"><a class="docs-heading-anchor" href="#Network">Network</a><a id="Network-1"></a><a class="docs-heading-anchor-permalink" href="#Network" title="Permalink"></a></h1><p><code>Network</code> is the main model type in DHNetworkSimulator. It represents a <strong>district heating network</strong> as a <em>directed graph</em>:</p><ul><li>water flows from one <strong>producer</strong> (the source/root),</li><li>through optional <strong>junctions</strong> (branching/merging points),</li><li>to multiple <strong>loads</strong> (consumers, typically leaves).</li></ul><p>Unlike a plain graph, a <code>Network</code> stores <em>typed domain data</em> on:</p><ul><li><strong>nodes</strong>: <code>ProducerNode</code>, <code>JunctionNode</code>, <code>LoadNode</code> (plus <code>EmptyNode</code> as a placeholder during construction),</li><li><strong>edges</strong>: typically <code>InsulatedPipe</code> (plus <code>EmptyEdge</code> as a placeholder during construction).</li><li>more on nodes and edges in <a href="../types/#Network-nodes-and-edges">Network nodes and edges</a></li></ul><p>This design makes it straightforward to build a topology, attach physical parameters, and run the hydraulic + thermal simulation.</p><p>See <a href="#Network"><code>Network</code></a> in the API reference.</p><h2 id="Features"><a class="docs-heading-anchor" href="#Features">Features</a><a id="Features-1"></a><a class="docs-heading-anchor-permalink" href="#Features" title="Permalink"></a></h2><ul><li><strong>Typed nodes and edges</strong>: domain structs like <a href="../API/#DHNetworkSimulator.ProducerNode"><code>ProducerNode</code></a>, <a href="../API/#DHNetworkSimulator.LoadNode"><code>LoadNode</code></a>, and <a href="../API/#DHNetworkSimulator.InsulatedPipe"><code>InsulatedPipe</code></a> are stored directly on the graph.</li><li><strong>Label-based addressing</strong>: access nodes/edges by string labels (<code>nw[&quot;A&quot;]</code>, <code>nw[&quot;A&quot;, &quot;B&quot;]</code>).</li><li><strong>Graphs.jl compatibility</strong>: <code>Network</code> subtypes <code>AbstractGraph</code>, so you can use functions like <code>nv</code>, <code>ne</code>, <code>vertices</code>, and <code>edges</code>.</li><li><strong>Validated structural assumptions</strong>: <a href="../API/#DHNetworkSimulator.run_simulation"><code>run_simulation</code></a> calls <a href="../API/#DHNetworkSimulator.check_network!"><code>DHNetworkSimulator.check_network!</code></a> to validate the topology (one producer, acyclic, connected, loads are leaves).</li><li><strong>Fast neighbor access</strong>: cached neighbor lists via <a href="../API/#DHNetworkSimulator.NeighborDicts"><code>NeighborDicts</code></a> with label-based helpers <a href="../API/#DHNetworkSimulator.outneighbors"><code>outneighbors</code></a> / <a href="../API/#DHNetworkSimulator.inneighbors"><code>inneighbors</code></a>.</li><li><strong>Built-in visualization</strong>: interactive plotting via <a href="../API/#DHNetworkSimulator.visualize_graph!"><code>visualize_graph!</code></a> with edge labels from <a href="../API/#DHNetworkSimulator.edge_info"><code>edge_info</code></a> / <a href="../API/#DHNetworkSimulator.edge_info_hover"><code>edge_info_hover</code></a>.</li></ul><h2 id="Implementation-details"><a class="docs-heading-anchor" href="#Implementation-details">Implementation details</a><a id="Implementation-details-1"></a><a class="docs-heading-anchor-permalink" href="#Implementation-details" title="Permalink"></a></h2><h3 id="MetaGraph"><a class="docs-heading-anchor" href="#MetaGraph">MetaGraph</a><a id="MetaGraph-1"></a><a class="docs-heading-anchor-permalink" href="#MetaGraph" title="Permalink"></a></h3><p>For the internal graph structure we use MetaGraph <code>MetaGraphNext.jl</code>, because it is type stable (not like <code>MetaGraphs.jl</code>). We prefer it over <code>Graphs.jl</code> for 2 main reasons:</p><ol><li>graph from <code>Graphs.jl</code> has not stable indexing: when a node is removed, all the nodes are reindexed so that there are no gaps in indexing. For example we have graph with three vertices {V[1], V[2], V[3]}. If we remove the middle vertex V[2], the vertex V[3]&#39;s indexing is changed to be V[2]. On the other hand, if we remove vertex V[B] from metagraph {V[A], V[B], V[C]}, the indexing (or rather <em>labeling</em>) stays the same and we get {V[A], V[C]}</li><li>MetaGraph lets us store node/edge data on the vertices/edges.</li></ol><h3 id="Indexing-by-Labels"><a class="docs-heading-anchor" href="#Indexing-by-Labels">Indexing by Labels</a><a id="Indexing-by-Labels-1"></a><a class="docs-heading-anchor-permalink" href="#Indexing-by-Labels" title="Permalink"></a></h3><p>Nodes and edges are addressed by <strong>string labels</strong>:</p><ul><li><code>nw[&quot;A&quot;]</code> returns the node data for label <code>&quot;A&quot;</code>.</li><li><code>nw[&quot;A&quot;, &quot;B&quot;]</code> returns the edge data from <code>&quot;A&quot;</code> to <code>&quot;B&quot;</code>.</li></ul><p>Because <code>Network</code> subtypes <code>AbstractGraph</code>, you can also use Graphs.jl-style APIs such as <code>nv</code>, <code>ne</code>, <code>vertices</code>, and <code>edges</code>.</p><div class="admonition is-warning" id="Graphs.jl-indices-vs-MetaGraphNext-labels-d76e8b5c5af261e2"><header class="admonition-header">Graphs.jl indices vs MetaGraphNext labels<a class="admonition-anchor" href="#Graphs.jl-indices-vs-MetaGraphNext-labels-d76e8b5c5af261e2" title="Permalink"></a></header><div class="admonition-body"><p>Functions like <code>vertices</code>, <code>edges</code>, <code>src(e)</code>, <code>dst(e)</code> from Graphs.jl give you <em>vertex indices</em> from the underlying graph. To convert an index back to a label, use <code>label_for(nw, idx)</code>.</p></div></div><h2 id="Structural-Assumptions-(Validated-at-Simulation-Start)"><a class="docs-heading-anchor" href="#Structural-Assumptions-(Validated-at-Simulation-Start)">Structural Assumptions (Validated at Simulation Start)</a><a id="Structural-Assumptions-(Validated-at-Simulation-Start)-1"></a><a class="docs-heading-anchor-permalink" href="#Structural-Assumptions-(Validated-at-Simulation-Start)" title="Permalink"></a></h2><p>The simulator assumes the network is <strong>static</strong> during a run (topology does not change while stepping). Before simulation starts, DHNetworkSimulator validates that:</p><ul><li>there is exactly one producer node (<code>producer_label</code> must be set),</li><li>the directed graph is acyclic,</li><li>the graph is connected (all nodes are reachable from the producer),</li><li>load nodes are leaves (outdegree 0).</li></ul><p><code>run_simulation</code> calls <code>check_network!</code> internally before the first step, which does all of that, no need to do it yourself.</p><h2 id="Neighbor-Caching-(NeighborDicts)"><a class="docs-heading-anchor" href="#Neighbor-Caching-(NeighborDicts)">Neighbor Caching (<code>NeighborDicts</code>)</a><a id="Neighbor-Caching-(NeighborDicts)-1"></a><a class="docs-heading-anchor-permalink" href="#Neighbor-Caching-(NeighborDicts)" title="Permalink"></a></h2><p>Thermal and hydraulic stepping frequently calls <code>outneighbors(nw, label)</code> and <code>inneighbors(nw, label)</code>. To reduce allocations and repeated work, <code>Network</code> maintains cached neighbor lists in <code>NeighborDicts</code>:</p><p>See <a href="../API/#DHNetworkSimulator.NeighborDicts"><code>NeighborDicts</code></a> in the API reference.</p><p>When you modify the network structure (add/remove/rename nodes or edges), the cache is marked dirty. It is rebuilt automatically when needed (for example in <code>run_simulation</code> via <code>check_network!</code>). Also simple call <code>outneighbors(network,label)</code> makes the cache update if marked dirty.</p><h2 id="Typical-Workflows"><a class="docs-heading-anchor" href="#Typical-Workflows">Typical Workflows</a><a id="Typical-Workflows-1"></a><a class="docs-heading-anchor-permalink" href="#Typical-Workflows" title="Permalink"></a></h2><h3 id="1)-Create-a-Network-From-a-Graph-Topology"><a class="docs-heading-anchor" href="#1)-Create-a-Network-From-a-Graph-Topology">1) Create a Network From a Graph Topology</a><a id="1)-Create-a-Network-From-a-Graph-Topology-1"></a><a class="docs-heading-anchor-permalink" href="#1)-Create-a-Network-From-a-Graph-Topology" title="Permalink"></a></h3><p>Use this when the topology already exists (e.g., imported from data or generated programmatically) and you want to attach node/edge data afterward.</p><pre><code class="language-julia hljs">using DHNetworkSimulator
using Graphs

# 1 -&gt; 2 -&gt; 3, and 2 -&gt; 4
g = DiGraph(4)
add_edge!(g, 1, 2)
add_edge!(g, 2, 3)
add_edge!(g, 2, 4)

nw = Network(g)
name_nodes!(nw, [&quot;P&quot;, &quot;J&quot;, &quot;L1&quot;, &quot;L2&quot;]) # rename 1..n to meaningful labels
identify_producer_and_loads!(nw)            # assign Producer/Junction/Load node types

# attach pipe parameters (edge data)
nw[&quot;P&quot;, &quot;J&quot;]  = InsulatedPipe(&quot;P→J&quot;;  length=300.0, inner_diameter=0.10)
nw[&quot;J&quot;, &quot;L1&quot;] = InsulatedPipe(&quot;J→L1&quot;; length=150.0, inner_diameter=0.08)
nw[&quot;J&quot;, &quot;L2&quot;] = InsulatedPipe(&quot;J→L2&quot;; length=180.0, inner_diameter=0.08)

ne(nw), nv(nw)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">(3, 4)</code></pre><p>We can also display all sorts of info about the network:</p><pre><code class="language-julia-repl hljs">julia&gt; nw
DH Network:
 Number of nodes: 4
 Number of edges: 3
 Producer node: P
 Load nodes (2): {L1, L2}
 Neighbor dicts need rebuild: true
---
Nodes in the network:
[1] L1 : Load Node, Info: L1, Load (at 0°C): 540.0 kW
[2] P : Producer Node, Info: P
[3] J : Junction Node, Info: J
[4] L2 : Load Node, Info: L2, Load (at 0°C): 540.0 kW
---
Edges in the network:
[2] P --&gt;  [3] J : Pipe Edge, L=300.0, D_in=0.1, R_f=3.0, R_b=4.0
[3] J --&gt;  [1] L1 : Pipe Edge, L=150.0, D_in=0.08, R_f=3.0, R_b=4.0
[3] J --&gt;  [4] L2 : Pipe Edge, L=180.0, D_in=0.08, R_f=3.0, R_b=4.0</code></pre><h3 id="2)-Build-a-Small-Network-Manually"><a class="docs-heading-anchor" href="#2)-Build-a-Small-Network-Manually">2) Build a Small Network Manually</a><a id="2)-Build-a-Small-Network-Manually-1"></a><a class="docs-heading-anchor-permalink" href="#2)-Build-a-Small-Network-Manually" title="Permalink"></a></h3><p>For quick experiments you can start from <code>Network()</code> and assign nodes/edges directly by label.</p><pre><code class="language-julia hljs">using DHNetworkSimulator

nw = Network()
nw[&quot;P&quot;]  = ProducerNode(&quot;Plant&quot;, (0.0, 0.0))
nw[&quot;L1&quot;] = LoadNode(&quot;House 1&quot;, (1.0, 0.0))

nw[&quot;P&quot;, &quot;L1&quot;] = InsulatedPipe(&quot;P→L1&quot;; length=200.0, inner_diameter=0.10)</code></pre><pre><code class="language-julia-repl hljs">julia&gt; nw
DH Network:
 Number of nodes: 2
 Number of edges: 1
 Producer node: P
 Load nodes (1): {L1}
 Neighbor dicts need rebuild: true
---
Nodes in the network:
[1] P : Producer Node, Info: Plant
[2] L1 : Load Node, Info: House 1, Load (at 0°C): 540.0 kW
---
Edges in the network:
[1] P --&gt;  [2] L1 : Pipe Edge, L=200.0, D_in=0.1, R_f=3.0, R_b=4.0</code></pre><h2 id="Network-visualization"><a class="docs-heading-anchor" href="#Network-visualization">Network visualization</a><a id="Network-visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Network-visualization" title="Permalink"></a></h2><p>Visualization (plotting) of network is another feature that will come in handy. We can pan, zoom and if we hover over an edge, it turns red and additional info is shown.</p><p>By calling <code>visualize_graph!(network)</code> we get Makies display of our network.</p><p>Blue nodes are loads, green is producer, black lines are pipes. The thicker the line, the bigger the pipe.</p><pre><code class="language-julia hljs">f, ax, p = visualize_graph!(network)
display(f)</code></pre><p><img src="../figures/network_viz1.png" alt="network_viz1"/> <em>Vizualization of example network</em></p><p>If there is computed steady state flow first, the visualization shows the flow in the edges as well. The darker the more flow there is, which makes easy to analyze turbulance. Also, additional info is written in labels next to the edges and the exact flow velocity in [m/s] is shown upon hover.</p><pre><code class="language-julia hljs">steady_state_hydronynamics!(network, 100.0)
f, ax, p = visualize_graph!(network)
display(f)</code></pre><p><img src="../figures/network_viz2.png" alt="network_viz2"/> <em>Zoomed in part of a network after computing steady state of hydrodynamics</em></p><h2 id="When-to-Use-Network"><a class="docs-heading-anchor" href="#When-to-Use-Network">When to Use <code>Network</code></a><a id="When-to-Use-Network-1"></a><a class="docs-heading-anchor-permalink" href="#When-to-Use-Network" title="Permalink"></a></h2><p><code>Network</code> is intended for modeling and simulation tasks such as:</p><ul><li><strong>Control and policy studies</strong>: define a <code>policy(t, Tₐ, T_back)</code> callback and see how actions affect supply/return temperatures.</li><li><strong>Design what-ifs</strong>: change pipe parameters and compare temperature drops, delays, and load satisfaction.</li><li><strong>Topology experiments</strong>: evaluate different branching structures and relative flow splits.</li><li><strong>Visualization &amp; debugging</strong>: inspect the graph, pipe information, and computed flows.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Plug_method/">« Plug Method</a><a class="docs-footer-nextpage" href="../types/">Nodes and Edges »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Monday 16 February 2026 20:46">Monday 16 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
